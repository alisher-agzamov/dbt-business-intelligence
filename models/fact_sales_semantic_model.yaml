semantic_models:
- name: fact_sales
  label: Sales Fact
  defaults:
    agg_time_dimension: date_day
  description: '|  Metric  |              Definition              |\n|----------|--------------------------------------|\n|
    quantity | Sum of quantity sold                 |\n| price    | Average price
    for an ordered product |\n| sales    | Sum of total sales revenue           |\n|
    target   | Sum of target sales revenue          |\n'
  model: ref('fact_sales')
  entities:
  - name: fact_sales_key
    type: primary
  - name: customer
    type: foreign
    expr: customer_key
  - name: order
    type: foreign
    expr: order_key
  - name: product
    type: foreign
    expr: product_key
  - name: date
    type: foreign
    expr: date_key
  measures:
  - name: price
    create_metric: true
    label: Price
    agg_time_dimension: date_day
    expr: price
    description: Price paid on this order
    agg: average
  - name: quantity
    create_metric: true
    label: Quantity
    agg_time_dimension: date_day
    expr: quantity
    agg: sum
  - name: sales
    create_metric: true
    label: Sales
    agg_time_dimension: date_day
    expr: sales
    description: The total revenue for each order.
    agg: sum
  - name: target
    create_metric: true
    label: Target
    agg_time_dimension: date_day
    expr: target
    description: Distinct count of customers placing orders
    agg: sum
  - name: row_count
    create_metric: true
    label: Rowcount
    agg_time_dimension: date_day
    expr: 1
    agg: sum
  - name: customer_count
    create_metric: true
    label: Customer Count
    agg_time_dimension: date_day
    expr: customer_key
    description: Distinct count of customers
    agg: count_distinct
  - name: product_count
    create_metric: true
    label: Product Count
    agg_time_dimension: date_day
    expr: product_key
    description: Distinct count of products
    agg: count_distinct
  - name: order_count
    create_metric: true
    label: Order Count
    agg_time_dimension: date_day
    expr: order_key
    description: Distinct count of orders
    agg: count_distinct
  - name: sales_to_target
    create_metric: true
    label: Sales to Target %
    agg_time_dimension: date_day
    expr: sales / target
    description: Percentage of actual sales to target sales
    agg: average
  dimensions:
  - name: date_day
    type_params:
      time_granularity: day
    type: time

metrics:
  - name: sales_to_target_raw_metric
    label: Sales to Target Ratio
    type: simple
    description: Percentage of actual sales to target sales
    type_params:
      measure: sales_to_target
    meta:
      format:
        type: percent
        decimalPlaces: 1
        suffix: "%"
      synonyms:
        - Sales Coverage Ratio
